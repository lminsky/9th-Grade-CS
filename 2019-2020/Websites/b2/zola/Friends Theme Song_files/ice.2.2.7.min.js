'use strict';var ICESettings,IC=IC||{};
IC.extension=function(k){var g=function(){var a=!!window.chrome,c=!/\bCrOS\b/.test(window.navigator.userAgent),b="undefined"!==typeof window.opr,m=-1<window.navigator.userAgent.indexOf("Edge");return a&&c&&"Google Inc."===window.navigator.vendor&&!1===b&&!1===m},f=function(){return"undefined"!==typeof window.InstallTrigger},d="https://chrome.google.com/webstore/detail/",e=null,n=!1,z=!0,B=!1,F="",w=null,t={count:0},C="",r={},x={},D={},l=new window.IC.logger,h=IC.utils,b=h.extendObject({},{aid:"",
eid:"",check_filename:"",checker:[],redirect_url:"",report_domain:"",ib_params:{},ext_url:"",store_url_prefix:"",pop_url:"",detect_private:!0,debug:!1,installType:"popup",downloadUrl:"",productType:"internal"},k);k=function(a,c){if(a){if(IC[a])return!0;if("boolean"===typeof c?c:1)throw Error("Missing required module: IC."+a);}return!1};var G=["utils","logger"],u;for(u in G)k(G[u]);var E=function(a,c){h.validateParam(a,"function");l.debug("Checking if extension already installed...");var y=[],m=function(){e=
0<y.length;F=(e?y:b.checker).join("_");l.debug("Extension "+(e?"already":"is not")+" installed");a(e)};if("boolean"===typeof e&&"true"!==c)return l.debug("Used cache to return determine is extension installed, result: "+e),a(e);-1<b.checker.indexOf("custom")&&"function"===typeof b.customChecker&&!0===b.customChecker()&&y.push("custom");-1<b.checker.indexOf("global")&&b.here&&y.push("global");var d;b.externalRSext instanceof Array&&0<b.externalRSext.length?(d=b.externalRSext,b.checker.push("external")):
d=[];-1<b.checker.indexOf("local")&&b.check_filename&&d.push({id:b.eid,f:b.check_filename,m:"local"});if(0<d.length)for(var f=0,k=function(a,c,b){f++;a&&y.push(b||c);f===d.length&&m()},g=0;g<d.length;g++)"object"===typeof d[g]&&H(d[g].id,d[g].f,d[g].m,k);else m()},p=function(a,c){h.validateParam(a,"string");c=c instanceof Object?c:{};a=a.toLowerCase();var b={name:a,params:c};if(r[a]instanceof Array&&0<r[a].length){var m=h.extendObject([],r[a]);m.shift()(b,m)}},q=function(a,c){h.validateParam(a,"string");
h.validateParam(c,"function");a=a.toLowerCase();/^((install|incognito)check)$/.test(a)&&l.warn("Event "+a+" is deprecated.");r[a]instanceof Array||(r[a]=[]);r[a].push(function(a,b){b instanceof Array&&c(a)&&0<b.length&&b.shift()(a,b)})},I=function(){var a=!0,c;for(c in x)x.hasOwnProperty(c)&&(a=a&&h.getCookieByName(c)===x[c]);return a},J=function(){var a=!0,c;for(c in x)x.hasOwnProperty(c)&&(a=a&&null!==h.getCookieByName(c));return a},v=function(a,c){h.validateParam(a,"string");c=c instanceof Object?
c:{};var d={timestamp:(new Date).toISOString(),client_ts:Date.now(),referrer:document.referrer,url_landing:window.location.href,language:navigator.language,action:a,icejs_ver:"2.2.7",extension_id:b.eid,affiliate:b.aid,check_filename:b.check_filename,checker:b.checker,redirect_url:b.redirect_url,is_incognito:w?1:0,if_ext_exist:e?1:0,chk_skip_reason:F,cookie_vld:I(),cookie_ext:J()},d=h.extendObject(d,b.ib_params,c);l.debug("Event parameters: ",d);var m=new XMLHttpRequest;m.onreadystatechange=function(){4==
m.readyState&&(200==m.status?l.debug('Event for "%s" successfully sent',a):l.debug('Failed to send event for "%s": #%s %s',a,m.status,m.statusText),p("eventSent",{action:a,status:200==m.status?!0:!1}))};m.open("POST",b.report_domain,!0);m.setRequestHeader("Content-Type","application/json");m.send(JSON.stringify(d))},K=function(a,c,b){var d;"newTab"===b?d=window.open(a,"_blank"):(c="directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=0,resizable=0,width="+c.width+",height="+
c.height+",top="+c.top+",left="+c.left,d=window.open(a,"_blank",c));var e=function(){setTimeout(function(){p("installFocus")},100)};z=!1;window.focus&&(d.focus(),window.onfocus=e);var f=setInterval(function(){d.closed&&(e(),clearInterval(f))},200)},A=function(a){a=a||b.ext_url;l.debug("Redirecting to %s",a);window.location.assign(a)};b.debug&&l.setLevel(l.LEVEL_DEBUG);if(g()){if(u=b.store_url_prefix)u+="/"===u[u.length-1]?"":"/",d+=u;b.ext_url=b.pop_url||d+b.eid}if(d=window.location.search.substring(1))D=
h.parseQueryString(d),l.debug("Query string: ",d),l.debug("Query parameters: ",D);b.detect_incognito&&(l.warn("Parameter detect_incognito is deprecated. Use detect_private instead."),b.detect_private=b.detect_incognito);l.debug("Settings: ",b);"installer"===b.installType?h.validateParam(b.downloadUrl,"string"):(h.validateParam(b.aid,"string"),h.validateParam(b.eid,"string","eid"),h.validateParam(b.check_filename,"string",!0,!0));h.validateParam(b.report_domain,"string");h.validateParam(b.ib_params,
"object",!0);h.validateParam(b.checker,"object",!0,!0);h.validateParam(b.redirect_url,"string",!0,!0);h.validateParam(b.detect_private,"boolean",!0);h.validateParam(b.debug,"boolean",!0);q("impression",function(){v("impression");return!0});q("checker_skip",function(){v("checker_skip");return!0});q("impression_no_offer",function(){v("impression_no_offer");return!0});q("impressionSent",function(){n=!0;"banner2store"===b.installType&&(C?A():(l.debug("Install id not found, starting timer (3s)"),setTimeout(A,
3E3)));return!0});q("checkerSkipSent",function(){b.redirect_url&&(l.debug("Redirecting to %s",b.redirect_url),window.location.assign(b.redirect_url));return!0});q("installClickSent",function(){"installer"===b.installType?A(b.downloadUrl):"redirect"===b.installType&&A();return!0});q("eventSent",function(a){if("string"===typeof a.params.action){var c=a.params.action.split("_");if(1<c.length)for(var b=1;b<c.length;b++)c[b]=c[b].charAt(0).toUpperCase()+c[b].slice(1);c=c.join("")+"Sent";p(c,a.params)}return!0});
q("installClick",function(){l.debug("User clicked on install button");v("install_click");return!0});q("installFocus",function(a){l.debug("User focus backed on the page");if(!0===B&&!0===z)return!0;b.checker=["local"];E(function(a){a&&!B?(z=B=!0,"external"===b.productType?v("install_success"):v("install_success_lp")):a||z||(z=!0,v("install_focus"))},"true");return!0});var H=function(a,c,b,d){var e=new Image;g()?e.src="chrome-extension://"+a+"/"+c:f()&&(e.src="chrome://"+a+"/"+c);e.onload=function(){d(!0,
a,b)};e.onerror=function(){d(!1,a,b)}};return{getVersion:function(){return"2.2.7"},setCallback:function(a,c){this.removeCallbacks(a);this.addCallback(a,c)},addCallback:function(a,c){q(a,c);l.debug('Added callback for event "%s"',a)},removeCallbacks:function(a){h.validateParam(a,"string");a=a.toLowerCase();var c=0;r[a]instanceof Array&&(c=r[a].length,r[a]=[]);l.debug('Removed %s callbacks for event "%s"',c,a)},addReportParam:function(a,c){h.validateParam(a,"string");h.validateParam(c,"string");b.ib_params[a]=
c},addQueryReportParam:function(a,c,b){h.validateParam(c,"string");(b=this.getQueryParam(a,b))&&this.addReportParam(c?c:a,b)},getQueryParam:function(a,c){h.validateParam(a,"string");var b=D[a];return"undefined"!==typeof b?c?decodeURIComponent(b):b:null},generateId:function(){return"yxxx-zzzzzzzzzzzz".replace(/[xyz]/g,function(a){var c=16*Math.random()|0;return("y"==a?c&3|8:c).toString(16)})},sendPixel:function(a,c){l.warn("Method sendPixel() is deprecated. Use sendReport() instead.");this.sendReport(a,
c)},sendReport:function(a,c){v(a,c)},setCookie:function(a,c,b){h.validateParam(a,"string");h.validateParam(c,"object");h.validateParam(b,"object",!0);var d=h.toQueryString(c),e={};e[a]=d;x[a]=d;e=h.extendObject(e,b);e=h.toQueryString(e,";",!1);l.debug("Trying to set cookie: %s",e);try{document.cookie=e;var f=h.getCookieByName(a)===d?!0:!1}catch(g){f=!1}f||l.debug("Failed to verify cookie");p("cookieSet",{name:a,value:c,params:b,verified:f})},deleteCookie:function(a){h.validateParam(a,"string");l.debug("Trying to delete cookie: %s",
a);try{document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";var c=-1===document.cookie.indexOf(a)?!0:!1}catch(b){c=!1}c||l.debug("Failed to verify cookie deleted");p("cookieDeleted",{name:a,verified:c})},getFingerprint:function(a){h.validateParam(a,"function");l.debug("Retrieving browser fingerprint...");if(2===t.count)l.debug("Found fingerprints from previous calls"),a(t);else if("undefined"===typeof Fingerprint2||"undefined"===typeof Fingerprint2v210)l.debug("Impossible to retrieve browser fingerprint");
else{var c=function(b,c){b===Fingerprint2.VERSION?(t.curr=c,t.count++,l.debug("Browser fingerprint ver %s: %s",b,c)):b===Fingerprint2v210.VERSION&&(t.new=c,t.count++,l.debug("Browser new fingerprint ver %s: %s",b,c));2===t.count&&a(t)},b=function(){Fingerprint2v210.get({},function(a){a=a.map(function(a){return a.value});a=Fingerprint2v210.x64hash128(a.join(""),31);c(Fingerprint2v210.VERSION,a)});(new Fingerprint2).get(function(a){c(Fingerprint2.VERSION,a)})};window.requestIdleCallback?requestIdleCallback(b):
setTimeout(b,500)}},isChrome:g,isFirefox:f,isIncognitoMode:function(a){l.warn("Method isIncognitoMode() is deprecated. Use isPrivateMode() instead.");this.isPrivateMode(a)},isPrivateMode:function(a){h.validateParam(a,"function");l.debug("Checking for private mode...");var b=function(b,c){w=b;c||(c="Running in "+(w?"private ":"regular ")+"mode");l.debug(c);a(w)};if("boolean"===typeof w)b(w);else if(g()){var d=window.RequestFileSystem||window.webkitRequestFileSystem;d?d(window.PERMANENT,100,function(){b(!1)},
function(){b(!0)}):b(!1,"Impossible to check private mode")}else if(f()){var e,k=0;try{e=window.indexedDB.open("test");var n=window.setInterval(function(){"done"==e.readyState&&(window.clearInterval(n),b(e.result?!1:!0));5<k++&&(window.clearInterval(n),b(!1,"Impossible to check private mode"))},10)}catch(p){b(!0)}}},isInstalled:E,start:function(){var a=function(){E(function(a){a?p("checker_skip"):p("impression")})};b.detect_private?this.isPrivateMode(a):a()},startNoOffer:function(){p("impression_no_offer")},
setInstallId:function(a){a&&"undefined"!==a&&(C=a,b.ext_url+="?install_id="+C,"banner2store"===b.installType&&n&&A())},install:function(){p("installClick");"installer"!==b.installType&&(g()?"popup"!==b.installType&&"newTab"!==b.installType||K(b.ext_url,b.popupPosition().popup,b.installType):f()&&window.InstallTrigger.install({Extension:b.ext_url},function(a,b){if(0===b)p("installComplete");else if(-210===b)p("installCancel",{error_code:b});else{switch(b){case -203:var d="Execution error";break;case -207:d=
"Cannot read archive";break;case -228:d="Download error";break;case -244:d="Unsupported type";break;default:d="Unexpected error occurred"}p("installError",{error_code:b,error_message:d.toLowerCase()})}}))}}};window.ICE=IC.extension;IC=IC||{};
IC.logger=function(){var k=1,g=[0,1,2],f=function(d,e){var f=1===arguments.length?[arguments[0]]:Array.apply(null,arguments),f=f.slice(1);if(d<k)return!1;try{switch(d){case 2:console.error.apply(console,f);break;case 1:console.warn.apply(console,f);break;default:console.log.apply(console,f)}}catch(g){try{opera.postError.apply(opera,f)}catch(B){return!1}}return!0};return{LEVEL_DEBUG:0,LEVEL_WARNING:1,LEVEL_ERROR:2,getVersion:function(){return"1.0"},setLevel:function(d){if(-1==g.indexOf(d))throw Error("Invalid log level: "+
d);k=d},log:function(d,e){if(-1==g.indexOf(d))throw Error("Invalid log level: "+d);if(!e)throw Error("At least one argument should be provided");f.apply(this,arguments)},debug:function(d){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.unshift(0);f.apply(this,e)},warn:function(d){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.unshift(1);f.apply(this,e)},error:function(d){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.unshift(2);
f.apply(this,e)}}};IC=IC||{};
IC.utils=function(){return{getVersion:function(){return"1.0"},validateParam:function(k,g,f,d){f="boolean"===typeof f?f:!1;d="boolean"===typeof d?d:!1;var e=typeof k;if(!f&&"undefined"===e)throw Error("Parameter is mandatory, but it is missing");if((f&&"undefined"!==e&&null!==k||!f)&&e!==g)throw new TypeError("Parameter type should be "+g+", but "+e+" provided");if(!d&&""===k)throw Error("Parameter can not be empty");return!0},validateNumberRange:function(k,g,f){k="number"===typeof k?k:0;g="number"===
typeof g?g:1;if(k<g)throw Error("Value is below the minimum of "+g);if("number"===typeof f&&k>f)throw Error("Value is above the maximum of "+f);return!0},toQueryString:function(k,g,f){var d=[];g=g||"&";"boolean"!==typeof f&&(f=!0);for(var e in k)if(k.hasOwnProperty(e)&&"function"!==typeof k[e]){var n=k[e];"object"===typeof k[e]?d.push(this.toQueryString(n,g,f)):(f&&(n=encodeURIComponent(n)),d.push([e,n].join("=")))}return d.join(g)},parseQueryString:function(k,g){var f={};if(k&&"string"===typeof k){var d=
k.split(g||"&"),e;for(e in d)if(d.hasOwnProperty(e)){var n=d[e].split("=");f[n[0]]=n[1]}}return f},extendObject:function(k,g){if(2>arguments.length)throw Error("At least 2 objects are expected");for(var f=0;f<arguments.length;f++)if(arguments.hasOwnProperty(f)){var d=arguments[f];this.validateParam(d,"object");if(0!==f)for(var e in d)d.hasOwnProperty(e)&&(k[e]=d[e])}return k},getCookieByName:function(k){var g;return(g=(new RegExp("(?:^|; )"+encodeURIComponent(k)+"=([^;]*)")).exec(document.cookie))?
g[1]:null}}}();
